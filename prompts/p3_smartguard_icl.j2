## SMART CONTRACT SECURITY AUDIT WITH LEARNED EXAMPLES

You are a security auditor specializing in Solidity smart contracts. Below are examples of vulnerable contracts with detailed security analysis. **Learn from these examples** to analyze the target contract.

---

{% if demonstrations %}
## IN-CONTEXT LEARNING EXAMPLES

The following are examples of real vulnerabilities with expert analysis. Study how the vulnerabilities are identified and explained, then apply the same analytical approach to the target contract.

{% for demo in demonstrations %}
### EXAMPLE {{ loop.index }}: {{ demo.category | upper }} VULNERABILITY

**Vulnerable Code:**
```solidity
{{ demo.vulnerable_code }}
```

{% if demo.get('chain_of_thought') %}
**Security Analysis:**
{{ demo.chain_of_thought }}

{% else %}
**Vulnerability Pattern:**
- **Category**: {{ demo.category }}
- **Title**: {{ demo.get('title', 'Vulnerability') }}
- **Description**: {{ demo.get('description', 'See code pattern above') }}
- **Detection Hint**: {{ demo.get('detection_hint', 'Review the code for this vulnerability type') }}
{% endif %}

**Classification**: This code contains a **{{ demo.category }}** vulnerability.

---

{% endfor %}
{% else %}
## VULNERABILITY KNOWLEDGE BASE

Apply your knowledge of DASP Top 10 vulnerability categories:
- **reentrancy**: External calls before state updates allowing recursive re-entry
- **arithmetic**: Unchecked arithmetic operations (overflow/underflow in pre-0.8 Solidity)
- **access_control**: Missing or weak authorization checks on sensitive functions
- **unchecked_low_level_calls**: Ignoring return values of call/send/delegatecall
- **time_manipulation**: Using block.timestamp for critical security logic
- **bad_randomness**: Predictable random number generation using blockchain values
- **denial_of_service**: Patterns that can block contract functionality
- **front_running**: Transaction order dependence vulnerabilities

---

{% endif %}

## TARGET CONTRACT FOR ANALYSIS

Now apply the same analytical approach demonstrated above to this contract:

```solidity
{{ contract_source }}
```

---

## YOUR ANALYSIS

Following the pattern shown in the examples:

### 1. Contract Overview
- What is this contract's purpose?
- What assets does it manage?
- Who are the intended users?

### 2. Function-by-Function Security Analysis
For each function, analyze:
- Access control: Who can call it?
- State changes: What is modified?
- External interactions: Any calls to other contracts?
- Trust assumptions: What must be true for safety?

### 3. Vulnerability Pattern Matching
{% if demonstrations %}
Compare the target contract to each example above:
{% for demo in demonstrations %}
- Does it have patterns similar to Example {{ loop.index }} ({{ demo.category }})?
{% endfor %}
{% else %}
Check for each DASP vulnerability type systematically.
{% endif %}

### 4. Evidence Documentation
For any vulnerability found:
- Identify exact line numbers
- Identify the vulnerable function
- Describe a concrete attack scenario
- Explain how the vulnerability could be exploited

---

## OUTPUT FORMAT

Provide your findings as a JSON array. Include ONLY vulnerabilities you have high confidence in, with concrete evidence:

```json
[
  {
    "category": "DASP category (reentrancy, access_control, arithmetic, unchecked_low_level_calls, denial_of_service, bad_randomness, front_running, time_manipulation, short_addresses, other)",
    "title": "Descriptive vulnerability title",
    "evidence": {
      "file": "contract.sol",
      "lines": [line_numbers_where_vulnerability_exists],
      "function": "vulnerable_function_name"
    },
    "explanation": "Clear explanation of the vulnerability and how an attacker could exploit it"
  }
]
```

Return `[]` if no vulnerabilities are found after thorough analysis.

---

Analyze the target contract using the methodology demonstrated in the examples above. Be thorough but precise - only report vulnerabilities you can clearly demonstrate with evidence.
