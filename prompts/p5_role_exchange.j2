## ROLE EXCHANGE VERIFICATION

Reference: Wei et al. 2024 - Role-swapping mechanism (Figure 5b)

This is a critical step in the LLM-SmartAudit process. Traditional LLM analysis
can produce inaccuracies or false positives. Role exchange helps reduce these
by having agents re-evaluate findings from a fresh perspective.

---

## CONTEXT:

You are the SOLIDITY PROGRAMMING EXPERT, but now you will adopt the
AUDITOR's perspective to re-verify the following findings.

After the initial analysis, roles are reversed: the Expert now acts as
if they were the Auditor, re-evaluating the contract from a fresh
perspective to identify potential false positives or missed issues.

---

## ORIGINAL FINDINGS TO VERIFY:

{{ original_findings }}

---

## CONTRACT:

```solidity
{{ contract_source }}
```

---

## ROLE EXCHANGE METHODOLOGY (per Figure 5b):

### Step 1: Fresh Perspective Analysis
For each finding, pretend you are seeing the contract for the first time:
- Does the vulnerability actually exist in the code?
- Is the evidence correctly cited (line numbers, function names)?
- Could there be a misunderstanding of the code's intent?

### Step 2: Challenge Each Finding
Play devil's advocate against each vulnerability claim:
- What would prevent this attack from succeeding?
- Are there implicit protections not mentioned?
- Is the severity rating appropriate?

### Step 3: Consensus Check
After role exchange, determine:
- Which findings survive the fresh perspective check?
- Which findings should be rejected as false positives?
- Are there any patterns that both perspectives might have missed?

---

## YOUR TASK:

For each finding from the original analysis, answer:

1. **Evidence Verification**: From a fresh perspective, does this vulnerability
   still look valid? Check line numbers and function names against actual code.

2. **False Positive Check**: Could this be a false positive that both agents
   agreed on by mistake? Look for implicit protections or misunderstandings.

3. **Independent Assessment**: Is the evidence convincing when viewed
   independently, without the bias of prior agreement?

---

## OUTPUT FORMAT:

Provide your role-exchange verification as structured JSON:

```json
{
  "role_exchange_summary": {
    "original_findings_count": 0,
    "verified_count": 0,
    "rejected_count": 0,
    "methodology": "Fresh perspective re-evaluation per Figure 5b"
  },
  "verified_findings": [
    {
      "title": "Finding title that SURVIVES re-verification",
      "original_severity": "original rating",
      "confidence_after_exchange": 0.0-1.0,
      "evidence_confirmed": true,
      "reasoning": "Why this finding is valid after role exchange"
    }
  ],
  "rejected_findings": [
    {
      "title": "Finding title that FAILS re-verification",
      "original_severity": "original rating",
      "rejection_reason": "Why this finding is likely a false positive",
      "evidence_issues": "Specific problems with the evidence"
    }
  ],
  "additional_observations": [
    "Any patterns noticed during role exchange that weren't in original analysis"
  ]
}
```

---

## IMPORTANT NOTES:

- Be rigorous but fair in your re-evaluation
- Don't reject findings just to appear thorough
- Don't confirm findings just to avoid conflict
- The goal is accurate vulnerability identification, not finding fault with prior work
- If uncertain, lean toward keeping the finding (security-conscious approach)
